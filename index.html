<!DOCTYPE html>
<html lang="en">
<head>
	<title>async</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="shower/themes/ribbon/styles/screen-4x3.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/4.1.0/rx.lite.js"></script>
	 <script type="text/javascript">

const { Observable } = Rx;

function HTML(template) {
    const buffer = document.createElement('div');
    buffer.innerHTML = template;
    return buffer.children[0];
}

function createMarbleDiagram(obs$, cont) {
    const raf$ = Observable.create(observer => {
        let rafId;
        let time = performance.now();

        const step = () => {
            const now = performance.now()
            const dt = now - time;
            time = now;
            observer.onNext(dt);

            rafId = requestAnimationFrame(step);
        }

        rafId = requestAnimationFrame(step);

        return () => cancelAnimationFrame(rafId); 
    })

    const diagramTemplate = () => `
    <div class="marble">
        <div class="os"></div>
    </div>`

    const eventTemplate = (name) => `
    <div class="event">${name}</div>`

    const diagram = HTML(diagramTemplate())
    cont.appendChild(diagram);

    const createEvent = value => {
        const event = HTML(eventTemplate(value));
        diagram.appendChild(event);

        const speed = 0.1
        const position = 0;

        const update$ = raf$.map(function(dt) {
            return dt * speed;
        }).scan(function(x, y) {
            return x + y;
        }, position).takeWhile(x => x > -2 && x < 900).doOnCompleted(() => event.parentNode.removeChild(event));

        return update$.withLatestFrom(Observable.of(event), (position, node) => ({position, node}));
    }

    const marble$ = obs$.flatMap(createEvent);

    return marble$.subscribe(({position, node}) => {
        // node.style.left = `${position}%`;
        node.style.transform = `translateX(-${position}px)`;
    });
}

</script>
  <style type="text/css">
.os {
    position: relative;
    top: 31px;
    z-index: -1;
    height: 2px;
    background-color: black;
}

.event {
    padding: 4px 14px;
    box-sizing: border-box;
    border: 2px solid;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    position: absolute;
    top: 0px;
    min-width: 60px;
    left: 100%;
    background-color: white;
}

.marble {
    overflow: hidden;
    position: relative;
    height: 62px;
}
    </style>
</head>
<body class="shower list">
	<header class="caption">
		<h1>RxJS</h1>
		<p>или еще одна либа в проекте</p>
	</header>
	<section class="slide" id="cover">
		<h2><img src="pictures/logo.png" id="logo"/>RxJS</h2>
		<p>или еще одна либа в проекте</p>
		<img src="pictures/bg.jpg" alt="" class="cover" id="bg">
		<style>
			#bg {
				max-width: none;
			}

			#logo {
				width: 65px;
				margin-right: 15px;
				margin-bottom: -5px;
			}

			#cover h2 {
				margin:30px 0 0;
				color:#FFF;
				font-size:70px;
			}
			#cover p {
				margin:10px 0 0;
				color:#FFF;
				font-style:italic;
				font-size:30px;
			}
		</style>
	</section>

	<section class="slide">
		<h2>Reactivnoe?</h2>
		<div class="imgc">
			<img src="pictures/ex.png">
		</div>
		<style type="text/css">
		.imgc {
			display: flex;
			justify-content: center;
			margin-top: 165px;
		}
		</style>
	</section>

	<section class="slide">
		<h2>Reactivnoe?</h2>
		<div class="imgc">
			<img src="pictures/exr.png">
		</div>
		<style type="text/css">
		.imgc {
			display: flex;
			justify-content: center;
			margin-top: 165px;
		}
		</style>
	</section>

	<section class="slide">
		<h2>Reactivnoe?</h2>
		<div class="imgc">
			<img src="pictures/reactiv.png">
		</div>
		<style type="text/css">
		.imgc {
			display: flex;
			justify-content: center;
			margin-top: 165px;
		}
		</style>
	</section>

	<section class="slide">
		<h2>JS</h2>
		<pre>
			<code>let a = 10;</code>
			<code>let b = 2;</code>
			<code>const sum = a + b;</code>
			<code>&nbsp;</code>
			<code>&nbsp;</code>
			<code>console.log(sum);</code>
			<code class="comment next">// 12</code>
		</pre>
	</section>

	<section class="slide">
		<h2>JS</h2>
		<pre>
			<code>let a = 10;</code>
			<code>let b = 2;</code>
			<code>const sum = a + b;</code>
			<code><strong>a = 100;</strong></code>
			<code>&nbsp;</code>
			<code>console.log(sum);</code>
			<code class="comment next">// 12</code>
		</pre>
		<div class="next imgl">
			<img src="pictures/fu.jpg">
		</div>
		<style type="text/css">
		.imgl {
			position: absolute;
			top: 41%;
			left: 47%;
		}
		</style>
	</section>

	<section class="slide">
		<h2>WatchedValue</h2>
		<pre>
			<code>const a = new WatchedValue(10);</code>
			<code>const b = new WatchedValue(2);</code>
			<code>const subscriber = () => console.log(a.value() + b.value());</code>
			<code>a.subscribe(subscriber); </code>
			<code>b.subscribe(subscriber), { callWithLatest: true });</code>
			<code>a.setValue(100);</code>
		</pre>
	</section>

	<section class="slide">
		<h2>WatchedValue</h2>
		<pre>
			<code>const a = new WatchedValue(10);</code>
			<code>const b = new WatchedValue(2);</code>
			<code>const subscriber = () => console.log(a.value() + b.value());</code>
			<code><strong>a.subscribe(subscriber); </strong></code>
			<code><strong>b.subscribe(subscriber), { callWithLatest: true });</strong></code>
			<code>a.setValue(100);</code>
		</pre>
	</section>

	<section class="slide">
		<h2>WatchedValue</h2>
		<pre>
			<code>const <strong>a</strong> = new WatchedValue(10);</code>
			<code>const <strong>b</strong> = new WatchedValue(2);</code>
			<code>const subscriber = () => console.log(<strong>a.value()</strong> + <strong>b.value()</strong>);</code>
			<code>a.subscribe(subscriber);</code>
			<code>b.subscribe(subscriber), { callWithLatest: true });</code>
			<code>a.setValue(100);</code>
		</pre>
	</section>

	<section class="slide">
		<h2>еще раз минусы WatchedValue</h2>
		<ul>
			<li class="next">Неудобная работа с подписками/отписками</li>
			<li class="next">Отсутсвие операций модификации/комбинирования</li>
			<li class="next">ошибки?</li>
		</ul>
		<div class="next imgl">
			<img src="pictures/fu.jpg">
		</div>
		<style type="text/css">
		.imgl {
			position: absolute;
			top: 41%;
			left: 47%;
		}
		</style>
	</section>

	<section class="slide">
		<h2>Observable</h2>
		<pre>
			<code>const a$ = new Subject();</code>
			<code>const b$ = new Subject();</code>
			<code>const sum$ = Observable.combineLatest(a$, b$, (a, b) => a + b);</code>
			<code>&nbsp;</code>
			<code>sum$.subscribe(x => console.log(x));</code>
			<code>&nbsp;</code>
			<code>a$.onNext(10);</code>
			<code>b$.onNext(2);</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Observable</h2>
		<pre>
			<code>const a$ = new <strong>Subject()</strong>;</code>
			<code>const b$ = new <strong>Subject()</strong>;</code>
			<code>const sum$ = Observable.combineLatest(a$, b$, (a, b) => a + b);</code>
			<code>&nbsp;</code>
			<code>sum$.subscribe(x => console.log(x));</code>
			<code>&nbsp;</code>
			<code>a$.onNext(10);</code>
			<code>b$.onNext(2);</code>
		</pre>
	</section>


	<section class="slide">
		<h2>Observable</h2>
		<pre>
			<code>const a$ = new Subject();</code>
			<code>const b$ = new Subject();</code>
			<code>const sum$ = Observable.<strong>combineLatest</strong>(a$, b$, (a, b) => a + b);</code>
			<code>&nbsp;</code>
			<code>sum$.subscribe(x => console.log(x));</code>
			<code>&nbsp;</code>
			<code>a$.onNext(10);</code>
			<code>b$.onNext(2);</code>
		</pre>
	</section>

	<section class="slide exampleCL">
		<h2>combineLatest</h2>
		<div class="exampleCL">
			<div class="stream">
				<div class="stream__name">a$:</div>
				<div class="stream__marble js-first"></div>
			</div>

			<div class="stream">
				<div class="stream__name">b$:</div>
				<div class="stream__marble js-second"></div>
			</div>

			<div class="stream">
				<div class="stream__name">combineLatest(a$, b$, (a, b) => a + b):</div>
				<div class="stream__marble js-last"></div>
			</div>
		</div>

		<script type="text/javascript">
			const example = document.querySelector('.exampleCL')
			const contFirst = example.querySelector('.js-first');
			const contSecond = example.querySelector('.js-second');
			const contLatest = example.querySelector('.js-last');
			const click$ = Observable.fromEvent(example, 'click', () => 1).scan((x, y) => x + y, 0);
			const button$ = Observable.fromEvent(document, 'keypress', e => e.keyCode).filter(v => v >= 48 && v <= 57).map(v => v - 48);
			const sum$ = Observable.combineLatest(click$, button$, (a, b) => a + b);

			createMarbleDiagram(click$, contFirst);
			createMarbleDiagram(button$, contSecond);
			createMarbleDiagram(sum$, contLatest);
		</script>
	</section>

	<section class="slide">
		<h2>Почему Обсервабл хорош для асинхронности</h2>
	</section>

	<section class="slide">
		<h2>Асинхронные операции</h2>
		<ul>
			<li class="next">AJAX</li>
			<li class="next">DOM события</li>
			<li class="next">Сокеты</li>
			<li class="next">Воркеры</li>
			<li class="next">Анимации</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Callbacks</h2>
	</section>

	<section class="slide">
		<h2>Callbacks hell</h2>
		<pre>
			<code>doSomeStaff(url, callback) {</code>
			<code>	doSomeAnotherStaff(var, data => {</code>
			<code>		doFinalStaff(data, url => {</code>
			<code>			callback(url)</code>
			<code>		})</code>
			<code>	})</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Promise</h2>
		<ul>
			<li class="next">Одно значение во времени</li>
			<li class="next">Неизменяемые</li>
			<li class="next">Нельзя отменить</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Promise покрывает только</h2>
		<ul class="next">
			<li>AJAX</li>
			<li id="hide">DOM события</li>
			<li id="hide">сокеты</li>
			<li id="hide">Воркеры</li>
			<li id="hide">Анимации</li>
		</ul>
		<style>
			#hide {
				text-decoration: line-through;
			}
		</style>
	</section>

	<section class="slide">
		<h2>Что такое RxJS</h2>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>function observable() {</code>
			<code>  return 1;</code>
			<code>  setTimeout(() => {</code>
			<code>    return 42;</code>
			<code>  }, 1000);</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>function observable() {</code>
			<code>  return 1;</code>
			<code>  <strong>setTimeout(() => {</strong></code>
			<code>    <strong>return 42;</strong></code>
			<code>  <strong>}, 1000);</strong></code>
			<code>}</code>
		</pre>
		<div id="qqq">dead code</div>
		<style>
			#qqq {
				position: absolute;
				top: 41%;
				left: 47%;
				font-size: 50px;
			}
		</style>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>function observable(<strong>observer</strong>) {</code>
			<code>  <strong>observer(1);</strong></code>
			<code>  setTimeout(() => {</code>
			<code>    <strong>observer(42);</strong></code>
			<code>  }, 1000);</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>observable(x => console.log(x));</code>
			<code class="comment next">// Next value: 1</code>
			<code class="comment next">// Next value: 42</code>
		</pre>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>function observable(observer) {</code>
			<code>  let i = 0;</code>
			<code>  const id = setInterval(() => observer(++i), 1000);</code>
			<code> </code>
			<code>  return () => clearInterval(id);</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>const disposable = observable(x => console.log(x));</code>
			<code class="comment next">// Next value: 1</code>
			<code class="comment next">// Next value: 2</code>
			<code class="comment next">// Next value: 3</code>
			<code class="comment next">// Next value: 4</code>
			<code class="comment next">// и тд</code>
		</pre>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>function filter(observable, fn) {</code>
			<code>  return function(observer) {</code>
			<code>    return observable(x => fn(x) && observer(x));</code>
			<code>  }</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>const oddNumbers = filter(observable, v => v % 2 === 0);</code>
			<code>const disposable = oddNumbers(x => console.log(x);</code>
			<code>});</code>
			<code class="comment next">// Next value: 1</code>
			<code class="comment next">// Next value: 3</code>
			<code class="comment next">// и тд</code>
		</pre>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>function map(observable, fn) {</code>
			<code>  return function(observer) {</code>
			<code>    return observable(x => observer(fn(x)));</code>
			<code>  }</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>const bigNumbers = map(observable, v => v * 100);</code>
			<code>const disposable = bigNumbers(x => console.log(x));</code>
			<code class="comment next">// Next value: 100</code>
			<code class="comment next">// Next value: 200</code>
			<code class="comment next">// и тд</code>
		</pre>
	</section>

	<section class="slide">
		<h2>&nbsp;</h2>
		<pre>
			<code>const oddNumbers = filter(observable, v => v % 2 === true)</code>
			<code>const bigOddNumbers = map(oddNumbers, v => v * 100);</code>
			<code>const disposable = bigNumbers(x => console.log(x));</code>
			<code class="comment next">// Next value: 100</code>
			<code class="comment next">// Next value: 300</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Observable методы</h2>
		<div id="row">
			<ul class="next">
				<li>combineLatest</li>
				<li>concat</li>
				<li>concatMap</li>
				<li>connect</li>
				<li>debounce</li>
				<li>delay</li>
				<li>dematerialize</li>
			</ul>
			<ul class="next">
				<li>distinctUntilChanged</li>
				<li>do</li>
				<li>filter</li>
				<li>finally</li>
				<li>flatMap</li>
				<li>flatMapLatest</li>
				<li>map</li>
			</ul>

			<ul class="next">
				<li>merge</li>
				<li>mergeAll</li>
				<li>multicast</li>
				<li>publish</li>
				<li>repeat</li>
				<li>replay</li>
				<li>retry</li>
			</ul>
			<ul class="next">
				<li>sample</li>
				<li>scan</li>
				<li>select</li>
				<li>skip</li>
				<li>startWith</li>
				<li>subscribe</li>
				<li>switch</li>
			</ul>
		</div>
		<style type="text/css">
			#row {
				display: flex;
			}

			#row ul {
				padding-right: 50px;
			}
		</style>
	</section>

	<section class="slide"></section>

	<div class="progress"></div>
	<script src="shower/shower.min.js"></script>
	<!-- Copyright © 2015 Yours Truly, Famous Inc. -->
	<!-- Photos by John Carey, fiftyfootshadows.net -->
</body>
</html>
